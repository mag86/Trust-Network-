# üó∫Ô∏è –ú–æ–¥—É–ª—å –ì–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (Geolocation)

–ú–æ–¥—É–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–∏—Å–∫–∞ nearby-–æ–±—ä–µ–∫—Ç–æ–≤ –∏ –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### FR2.1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏: GPS (5-50–º), Wi-Fi (50-200–º), Cell Tower (200-2000–º), IP (–≥–æ—Ä–æ–¥—Å–∫–æ–π —É—Ä–æ–≤–µ–Ω—å)
- –£—Ä–æ–≤–Ω–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏: HIGH (‚â§50–º), MEDIUM (‚â§500–º), LOW (‚â§5–∫–º), CITY (‚â§50–∫–º)
- –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ (15 –º–∏–Ω), –ø–æ –∑–∞–ø—Ä–æ—Å—É

### FR2.2: –ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Ä–∞–¥–∏—É—Å–µ
- –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏
- –ü–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏
- –†–∞–¥–∏—É—Å –ø–æ–∏—Å–∫–∞: 100–º - 50–∫–º
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è: –¥–æ 20 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ: —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (60%), —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (25%), –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (10%), —Ä–µ–ø—É—Ç–∞—Ü–∏—è (5%)

### FR2.3: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
- –£—Ä–æ–≤–Ω–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏: –¢–æ—á–Ω–æ–µ, –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ–µ, –ì–æ—Ä–æ–¥—Å–∫–æ–µ, –°–∫—Ä—ã—Ç–æ–µ
- –ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å: –∫–æ–º—É –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏
- –ì–µ–æ-–∑–æ–Ω—ã: –¥–æ–º/—Ä–∞–±–æ—Ç–∞ (—Ç–æ—á–Ω–∞—è), –ø—É–±–ª–∏—á–Ω—ã–µ –º–µ—Å—Ç–∞ (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è), –Ω–µ–∑–Ω–∞–∫–æ–º—ã–µ —Ä–∞–π–æ–Ω—ã (—Å–∫—Ä—ã—Ç–∞—è)

### FR2.4: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ö—ç—à –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (5 –º–∏–Ω—É—Ç TTL)
- –ö—ç—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ (2 –º–∏–Ω—É—Ç—ã TTL)
- –ö—ç—à –≥–µ–æ-–∑–æ–Ω (24 —á–∞—Å–∞ TTL)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏

## üöÄ API Endpoints

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º

#### GET `/api/locations/{userId}`
–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Response:** 200 OK
```json
{
  "id": 1,
  "userId": 1,
  "latitude": 55.7558,
  "longitude": 37.6173,
  "accuracy": "HIGH",
  "source": "GPS",
  "address": "–ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å, 1",
  "city": "–ú–æ—Å–∫–≤–∞",
  "district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π",
  "updatedAt": "2025-10-31T22:00:00",
  "lastActiveAt": "2025-10-31T22:00:00"
}
```

#### PUT `/api/locations/{userId}`
–û–±–Ω–æ–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ

**Request Body:**
```json
{
  "latitude": 55.7558,
  "longitude": 37.6173,
  "accuracy": "HIGH",
  "source": "GPS",
  "address": "–ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å, 1",
  "city": "–ú–æ—Å–∫–≤–∞",
  "district": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π"
}
```

#### POST `/api/locations/{userId}/active`
–û–±–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –ü–æ–∏—Å–∫ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏

#### POST `/api/geo/search/nearby-users`
–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏

**Request Body:**
```json
{
  "latitude": 55.7558,
  "longitude": 37.6173,
  "radiusMeters": 1000,
  "limit": 20,
  "page": 0
}
```

**Response:** 200 OK
```json
[
  {
    "id": 2,
    "userId": 2,
    "latitude": 55.7560,
    "longitude": 37.6175,
    "accuracy": "HIGH",
    "distance": 250.5,
    "address": "–ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 10"
  }
]
```

#### GET `/api/geo/search/nearby-users`
–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (GET –≤–∞—Ä–∏–∞–Ω—Ç)

**Query Parameters:**
- `latitude` - –®–∏—Ä–æ—Ç–∞
- `longitude` - –î–æ–ª–≥–æ—Ç–∞
- `radiusMeters` (default: 1000) - –†–∞–¥–∏—É—Å –≤ –º–µ—Ç—Ä–∞—Ö
- `limit` (default: 20) - –õ–∏–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

#### GET `/api/geo/privacy/{userId}`
–ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–æ-–ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

**Response:** 200 OK
```json
{
  "id": 1,
  "userId": 1,
  "visibility": "APPROXIMATE",
  "sharingRule": "ALL",
  "showOnlyWhenOnline": false,
  "hideWhenInactive": true,
  "inactivityMinutes": 30
}
```

#### PUT `/api/geo/privacy/{userId}`
–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

**Request Body:**
```json
{
  "visibility": "CITY_ONLY",
  "sharingRule": "FRIENDS",
  "showOnlyWhenOnline": true,
  "hideWhenInactive": true,
  "inactivityMinutes": 60
}
```

#### GET `/api/geo/privacy/{userId}/location?requesterId={requesterId}`
–ü–æ–ª—É—á–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é —Å —É—á–µ—Ç–æ–º –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

**Query Parameters:**
- `requesterId` - ID –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Response:** 200 OK –∏–ª–∏ 404 (–µ—Å–ª–∏ —Å–∫—Ä—ã—Ç–∞)

### –ì–µ–æ-–∑–æ–Ω—ã

#### GET `/api/geo/zones/{userId}`
–ü–æ–ª—É—á–∏—Ç—å –≥–µ–æ-–∑–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Response:** 200 OK
```json
[
  {
    "id": 1,
    "userId": 1,
    "name": "–î–æ–º",
    "type": "HOME",
    "centerLatitude": 55.7558,
    "centerLongitude": 37.6173,
    "radiusMeters": 500,
    "visibilityInZone": "EXACT",
    "createdAt": "2025-10-31T20:00:00"
  }
]
```

#### POST `/api/geo/zones/{userId}`
–°–æ–∑–¥–∞—Ç—å –≥–µ–æ-–∑–æ–Ω—É

**Request Body:**
```json
{
  "name": "–†–∞–±–æ—Ç–∞",
  "type": "WORK",
  "centerLatitude": 55.7500,
  "centerLongitude": 37.6000,
  "radiusMeters": 1000,
  "visibilityInZone": "EXACT"
}
```

#### DELETE `/api/geo/zones/{zoneId}?userId={userId}`
–£–¥–∞–ª–∏—Ç—å –≥–µ–æ-–∑–æ–Ω—É

## üìä –£—Ä–æ–≤–Ω–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏

| –£—Ä–æ–≤–µ–Ω—å | –î–∏–∞–ø–∞–∑–æ–Ω | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|---------|----------|---------------|
| `HIGH` | ‚â§ 50–º | –¢–æ—á–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∞ |
| `MEDIUM` | ‚â§ 500–º | –ü–æ–∏—Å–∫ –≤ —Ä–∞–π–æ–Ω–µ |
| `LOW` | ‚â§ 5–∫–º | –ì–æ—Ä–æ–¥—Å–∫–æ–π –ø–æ–∏—Å–∫ |
| `CITY` | ‚â§ 50–∫–º | –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ |

## üìä –£—Ä–æ–≤–Ω–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏

| –£—Ä–æ–≤–µ–Ω—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `EXACT` | –¢–æ—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é |
| `APPROXIMATE` | –†–∞–π–æ–Ω/–∫–≤–∞—Ä—Ç–∞–ª (500–º —Ä–∞–¥–∏—É—Å) |
| `CITY_ONLY` | –¢–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥/—Ä–∞–π–æ–Ω –≥–æ—Ä–æ–¥–∞ |
| `HIDDEN` | –õ–æ–∫–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç–∞ |

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- **Task –º–æ–¥—É–ª—å:** –ì–µ–æ–ø–æ–∏—Å–∫ –∑–∞–¥–∞—á –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏
- **Profile –º–æ–¥—É–ª—å:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
- **Redis:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–∞–¥–∏—É—Å–µ 2 –∫–º
```http
GET /api/geo/search/nearby-users?latitude=55.7558&longitude=37.6173&radiusMeters=2000&limit=10
```

### –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–æ-–∑–æ–Ω—ã –¥–ª—è –¥–æ–º–∞
```json
POST /api/geo/zones/1
{
  "name": "–î–æ–º",
  "type": "HOME",
  "centerLatitude": 55.7558,
  "centerLongitude": 37.6173,
  "radiusMeters": 500,
  "visibilityInZone": "EXACT"
}
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
- –°–∫—Ä—ã—Ç–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º sharing (–≤—Å–µ–º/–¥—Ä—É–∑—å—è–º/–Ω–∏–∫–æ–º—É)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏

